use macros::model;

use crate::{
    errors::{ExpectedLength, InvalidLength, MissingField},
    union::ics23::{existence_proof::ExistenceProof, non_existence_proof::NonExistenceProof},
};

#[model(proto(raw(protos::ibc::core::commitment::v1::MerkleProof), into, from))]
// TODO: Rename to optimized merkle proof
pub enum MerkleProof {
    Membership(ExistenceProof, ExistenceProof),
    NonMembership(NonExistenceProof, ExistenceProof),
}

#[derive(Debug, Clone, PartialEq, thiserror::Error)]
pub enum TryFromMerkleProofError {
    #[error(transparent)]
    MissingField(#[from] MissingField),
    #[error("unable to decode existence proof")]
    Existence(#[from] crate::union::ics23::existence_proof::TryFromExistenceProofError),
    #[error("unable to decode non existence proof")]
    NonExistence(#[from] crate::union::ics23::non_existence_proof::TryFromNonExistenceProofError),
    #[error("invalid commitment proof type")]
    InvalidCommitmentProofType,
    #[error("invalid proofs length")]
    InvalidProofsLength(#[from] InvalidLength),
}

impl TryFrom<protos::ibc::core::commitment::v1::MerkleProof> for MerkleProof {
    type Error = TryFromMerkleProofError;

    fn try_from(
        value: protos::ibc::core::commitment::v1::MerkleProof,
    ) -> Result<Self, Self::Error> {
        use protos::cosmos::ics23::v1::{
            commitment_proof::Proof as RawProof, CommitmentProof as RawCommitmentProof,
        };

        let proofs: [_; 2] = value.proofs.try_into().map_err(|invalid: Vec<_>| {
            TryFromMerkleProofError::InvalidProofsLength(InvalidLength {
                expected: ExpectedLength::Exact(2),
                found: invalid.len(),
            })
        })?;

        match proofs {
            [RawCommitmentProof {
                proof: Some(RawProof::Exist(exist_1)),
            }, RawCommitmentProof {
                proof: Some(RawProof::Exist(exist_2)),
            }] => Ok(Self::Membership(exist_1.try_into()?, exist_2.try_into()?)),
            [RawCommitmentProof {
                proof: Some(RawProof::Nonexist(non_exist)),
            }, RawCommitmentProof {
                proof: Some(RawProof::Exist(exist)),
            }] => Ok(Self::NonMembership(
                non_exist.try_into()?,
                exist.try_into()?,
            )),
            [_, _] => Err(TryFromMerkleProofError::InvalidCommitmentProofType),
        }
    }
}

impl From<MerkleProof> for protos::ibc::core::commitment::v1::MerkleProof {
    fn from(value: MerkleProof) -> Self {
        use protos::cosmos::ics23::v1::{
            commitment_proof::Proof as RawProof, CommitmentProof as RawCommitmentProof,
        };

        match value {
            MerkleProof::Membership(a, b) => Self {
                proofs: vec![
                    RawCommitmentProof {
                        proof: Some(RawProof::Exist(a.into())),
                    },
                    RawCommitmentProof {
                        proof: Some(RawProof::Exist(b.into())),
                    },
                ],
            },
            MerkleProof::NonMembership(a, b) => Self {
                proofs: vec![
                    RawCommitmentProof {
                        proof: Some(RawProof::Nonexist(a.into())),
                    },
                    RawCommitmentProof {
                        proof: Some(RawProof::Exist(b.into())),
                    },
                ],
            },
        }
    }
}

#[cfg(feature = "ethabi")]
impl crate::encoding::Encode<crate::encoding::EthAbi> for MerkleProof {
    fn encode(self) -> Vec<u8> {
        use ethers::abi::Tokenizable;

        use crate::union::ics23::{
            existence_proof::ExistenceProofEthAbi, non_existence_proof::NonExistenceProofEthAbi,
        };

        match self {
            MerkleProof::Membership(a, b) => ethers::abi::ethabi::encode(&[
                ExistenceProofEthAbi::from(a).into_token(),
                ExistenceProofEthAbi::from(b).into_token(),
            ]),
            MerkleProof::NonMembership(a, b) => ethers::abi::ethabi::encode(&[
                NonExistenceProofEthAbi::from(a).into_token(),
                ExistenceProofEthAbi::from(b).into_token(),
            ]),
        }
    }
}

#[cfg(test)]
mod tests {
    use ethers::abi::{ethabi, AbiType, Token, Tokenizable};
    use hex_literal::hex;

    use super::*;
    use crate::{
        encoding::{DecodeAs, EncodeAs, EthAbi, Proto},
        union::ics23::{
            existence_proof::ExistenceProofEthAbi, non_existence_proof::NonExistenceProofEthAbi,
        },
    };

    #[test]
    fn ethabi() {
        proto_eth_roundtrip(&hex::decode("0a96061293060a15014152090b0c95c948edc407995560feed4a9df88812fa020a15014152090b0c95c948edc407995560feed4a9df81e129e010a202f636f736d6f732e617574682e763162657461312e426173654163636f756e74127a0a2c756e696f6e31673966716a7a63766a687935336d77797137763432633837613439666d37713772646568386312460a1f2f636f736d6f732e63727970746f2e736563703235366b312e5075624b657912230a2103820c4b94dccd7d74706216c426fe884d9a4404410df69d6421899595c5a9c122180420031a0b0801180120012a0300027822290801122502047820170c890f01b9fa9ab803511bbc7be7c25359309f04d021a72e0a9b93b8ff72c020222c0801120504089601201a21205f282a80f1d186fa1f7b237f81e8bc9a4bb40d5a03cbbdffdd421b1ad4cb16f4222c0801120506109601201a2120e9c65294b7106c7323dcabe4532232c319afc78cd373e338f12df43f8ecfa909222c080112050a309601201a2120a95af7890dba33514ea28a3db7b409f4887b058d6d1e43960c4cd45bb1d9bef81afc020a150143e46d91544517a037a8029b6c7f86f62bab389b129e010a202f636f736d6f732e617574682e763162657461312e426173654163636f756e74127a0a2c756e696f6e3167306a786d79323567357436716461677132646b636c7578376334366b77796d38646563667712460a1f2f636f736d6f732e63727970746f2e736563703235366b312e5075624b657912230a21034611ea6606f6241fdeb0db1854a785eaa2fef5770694237daaf46057cadb3903180320031a0c0801180120012a0400029601222c0801120502049601201a2120532543090d1564b206e953fd6f97000d9b78bd5a8a424f551d483a58b3f54c57222a0801122604089601207e55a1ee8006e9c29c895a8de8ea8cdc6aaddc10e05ea3d3ee8fac786a73c02d20222c0801120506109601201a2120e9c65294b7106c7323dcabe4532232c319afc78cd373e338f12df43f8ecfa909222c080112050a309601201a2120a95af7890dba33514ea28a3db7b409f4887b058d6d1e43960c4cd45bb1d9bef80a80020afd010a0361636312205281c416bf4f80b9d99428a09f91ff311968a3b2adb199342d63c9db20a417e91a090801180120012a010022250801122101ba30cf8122e71a87fea08d0da9499e0373495a64e1648de8f08ca1a73e1fc1a8222708011201011a203489cd05a389a1d165f19003cea0994df9e55a5cb53b3d659417040be528b86d222708011201011a20e5c60ddccacb1c6b0be7957e8d7a86dc0f8bcec91c91d666d39eb1ebedd1bdf1222708011201011a2047a4c9a64496594e8b255443aa979293b2c7120150cf31e0eeeb8a2a987fd7e8222708011201011a2053bca15bed4becbdfd1b4cd0e63bd3845646022a99a2289a6678d8608f092207").unwrap());
        proto_eth_roundtrip(&hex::decode("0ab0030aad030a1d636c69656e74732f30382d7761736d2d312f636c69656e74537461746512c7010a252f6962632e6c69676874636c69656e74732e7761736d2e76312e436c69656e745374617465129d010a720a20d8ea171f3c94aea21ebc42a1ed61052acf3f9209c00e4efbaaddac09ed9b807818e0fac1950622310a04900000691a060a049000007022060a04900000712a060a049000007232110a040400000010ffffffffffffffffff01280c30203880024204080110034880c2d72f50a0f4a4011220e8dcc770de5a013041588233812f73ac797ec6078b0011cbcbfe49d474f4c1191a051081f2e7011a0c0801180120012a040002ae06222c080112050204b006201a2120980ab410769397da376376a2756754b225f34cc0eea404b068924f64180abcc4222c080112050408b006201a21209d79cf7fc2f248ea0a56cff266ac54cfbc06687e25ffee99aec2884856d0104f222a080112260610b006203e808c2bc895d44d05d7af6d8b0424fabb1d9ab6f53b10cdb084b2996f75bfa620222c08011205081eb006201a212095bb7de983d8ea1282a2d60e2f6c675bec25f82be86aa874ff0f15827c1ab3ed0afc010af9010a036962631220859b7ac80b1c0ca82504e0d8e9de460d42ca66a03e708cbd09869e5216c73a591a090801180120012a01002225080112210106b99c0d8119ff1edbcbe165d0f19337dbbc080e677c88e57aa2ae767ebf0f0f222708011201011a20aa650406ea0d76e39dd43d2ea6a91e3fdaa1c908fc21a7ca68e5e62cc8115639222508011221016ac3182364d7cdaa1f52a77b6081e070aa29b2d253f3642169693cde336e2bdc22250801122101c9d0a585c82dc572f3fcedc70302d4c3fbbc9e84f0618c6b446a70efa312e8dc222708011201011a20952029410a533cf530124179204303bea59a86f5b4993291c5b8ca406412c5f7").unwrap());
        proto_eth_roundtrip(&hex::decode("0abc020ab9020a18636f6e6e656374696f6e732f636f6e6e656374696f6e2d31125b0a0930382d7761736d2d3112230a0131120d4f524445525f4f524445524544120f4f524445525f554e4f524445524544180222250a0e636f6d6574626c732d6e65772d30120c636f6e6e656374696f6e2d301a050a0369626328061a0c0801180120012a040002f006222c080112050204f006201a212075c4910f51207d3c65960120fe931f138e2624668d75869f51b8442593dd5eab222a080112260408de0a2002b6fcf07091245d162f1196b003c555c564980e02c4d4a9fa0a249798f4b25e20222c08011205060ede0a201a2120ff6b0a04e076eecbabfee4e751c0523cbedba898211b5847404e2d954a2203e3222a08011226081ede0a20635053419cfb6a81c839860d99f3ed002840124a790ddd9f066d8bce63f9df54200afc010af9010a03696263122024b15e198bcf648dee62c7ca1fd8c3950c85c3d898833180c3e3c412ccbc559d1a090801180120012a01002225080112210106b99c0d8119ff1edbcbe165d0f19337dbbc080e677c88e57aa2ae767ebf0f0f222708011201011a20aa650406ea0d76e39dd43d2ea6a91e3fdaa1c908fc21a7ca68e5e62cc8115639222508011221016ac3182364d7cdaa1f52a77b6081e070aa29b2d253f3642169693cde336e2bdc222508011221016376cbd7b917c7105ddac35bdeddd79e6c9cbbc66dd227941599de2b9bc8b3de222708011201011a200d68ac7c3e8daf94c65ccdfe5b7397f50e80325240ef9b2a0ec483afaea30544").unwrap());
        proto_eth_roundtrip(&hex::decode("0afa020af7020a15014152090b0c95c948edc407995560feed4a9df81e129e010a202f636f736d6f732e617574682e763162657461312e426173654163636f756e74127a0a2c756e696f6e31673966716a7a63766a687935336d77797137763432633837613439666d37713772646568386312460a1f2f636f736d6f732e63727970746f2e736563703235366b312e5075624b657912230a2103820c4b94dccd7d74706216c426fe884d9a4404410df69d6421899595c5a9c122180120011a0b0801180120012a0300020222290801122502040220170c890f01b9fa9ab803511bbc7be7c25359309f04d021a72e0a9b93b8ff72c020222b08011204040802201a2120a89a7b1aedf861a8c6316009af3d19448bfe8834dfb5546c7e1af7f95c3000b4222b08011204061002201a212029347d33c119e85fc1335f43ad17c4a1986ad44c71837158ceffd36e2f38f986222b080112040a3002201a2120e284b7ed0385d018b1ffcd6f33bf6ac575fb7731704d0ae71be278bd8bf5e0b50a80020afd010a03616363122082d7d632a58654a81bb6764379eff4b6e641e96620a12dac0e250e6caf94f7761a090801180120012a010022250801122101ba30cf8122e71a87fea08d0da9499e0373495a64e1648de8f08ca1a73e1fc1a8222708011201011a208a19e0585632ebada293099d24f28707d453266ae7ded6e854dfd8a025c7ce71222708011201011a204a22410f42f7706402b38c460e74d712c95cea8e6e370c691f43c0abf3f4e104222708011201011a20b999d9a62cbd36a843f207580c4802d194e6441f7f3715ddce55d5194d46e57a222708011201011a2022ecbf124eff995ecf01998dd8346b71810af164e192feeb4d4287085128b9df").unwrap());
    }

    fn proto_eth_roundtrip(bz: &[u8]) {
        let proof = MerkleProof::decode_as::<Proto>(bz).unwrap();
        let ethabi_bz = proof.clone().encode_as::<EthAbi>();

        match proof {
            MerkleProof::Membership(exist_1, exist_2) => {
                println!("{}", hex::encode(&ethabi_bz));

                let [exist_1_tokens, exist_2_tokens]: [Token; 2] = ethabi::decode(
                    &[
                        ExistenceProofEthAbi::param_type(),
                        ExistenceProofEthAbi::param_type(),
                    ],
                    &ethabi_bz,
                )
                .unwrap()
                .try_into()
                .unwrap();

                let exist_1_ethabi = ExistenceProofEthAbi::from_token(exist_1_tokens).unwrap();
                let exist_2_ethabi = ExistenceProofEthAbi::from_token(exist_2_tokens).unwrap();

                assert_eq!(exist_1, exist_1_ethabi.into());
                assert_eq!(exist_2, exist_2_ethabi.into());
            }
            MerkleProof::NonMembership(non_exist, exist) => {
                println!("{}", hex::encode(&ethabi_bz));

                let [non_exist_tokens, exist_tokens] = ethabi::decode(
                    &[
                        NonExistenceProofEthAbi::param_type(),
                        ExistenceProofEthAbi::param_type(),
                    ],
                    &ethabi_bz,
                )
                .unwrap()
                .try_into()
                .unwrap();

                let non_exist_ethabi =
                    NonExistenceProofEthAbi::from_token(non_exist_tokens).unwrap();
                let exist_ethabi = ExistenceProofEthAbi::from_token(exist_tokens).unwrap();

                assert_eq!(non_exist, non_exist_ethabi.into());
                assert_eq!(exist, exist_ethabi.into());
            }
        }
    }

    #[test]
    fn decode() {
        let bz = hex!("00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000002fa00000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000016a0000000000000000000000000000000000000000000000000000000000000007c636f6d6d69746d656e74732f706f7274732f7761736d2e756e696f6e316d383761357363786e6e6b38337766776170786c75667a6d35387165327636353938356578666637307a3935613279723836797137686c3038682f6368616e6e656c732f6368616e6e656c2d38322f73657175656e6365732f3333353633350000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000007a636f6d6d69746d656e74732f706f7274732f7761736d2e756e696f6e316d383761357363786e6e6b38337766776170786c75667a6d35387165327636353938356578666637307a3935613279723836797137686c3038682f6368616e6e656c732f6368616e6e656c2d38312f73657175656e6365732f353139310000000000000000000000000000000000000000000000000000000000000000000000000020d6c224ae864a6697721e1e5a49a8895d9776138c5cfe2af8b107c93829b81c46000000000000000000000000000000000000000000000000000000000000000600028a9383010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001500000000000000000000000000000000000000000000000000000000000002a000000000000000000000000000000000000000000000000000000000000003600000000000000000000000000000000000000000000000000000000000000420000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000005c000000000000000000000000000000000000000000000000000000000000006800000000000000000000000000000000000000000000000000000000000000740000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000008e000000000000000000000000000000000000000000000000000000000000009c00000000000000000000000000000000000000000000000000000000000000a800000000000000000000000000000000000000000000000000000000000000b600000000000000000000000000000000000000000000000000000000000000c400000000000000000000000000000000000000000000000000000000000000d200000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000ee00000000000000000000000000000000000000000000000000000000000000fc000000000000000000000000000000000000000000000000000000000000010a0000000000000000000000000000000000000000000000000000000000000118000000000000000000000000000000000000000000000000000000000000012400000000000000000000000000000000000000000000000000000000000001320000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000280406b6d4e402200271c65e1115ebc00b27861dbb699e0921e6ef09437d6825393a4bcbef4fef68200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000280814b6d4e40220ada8c9ec41c54cd7bab0867c6d75ff5fcb0b595ca1a311aa321c7e69281c03d92000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000070c48ced4e4022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120a088547cacd2771159a4b69d943785916bde62f713053408aab2d078db403dc900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000280e72ced4e40220142b8b50a46d6b1fe46e0017c3fb6885b31e6c3d2bd60d8e64b3c694d18bffb0200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002910d001ced4e40220ca653fc2440cd426e2388ee2276504cbddc912c094af5e55e05c1a0c4ffbafa72000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002912e002ced4e402206f773d8a23bebf9e81fa22028c158c459e75d3549674b6742cbb3b95f7bc5fd22000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002914fe06fcd4e4022046c5706ad049ebf145d91d2daab621dc13f3295af175ab1bffe130a12aa8988f200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000816be0bfcd4e40220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120d0c0ee05aedecaa1cae2aa758f6f71c54188f55d160e1aa1184bfce0a8e2d5a10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000818ee13fcd4e402200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000021209b8f586e95fc8758f955833dca17d3717209fb2fb0bf586198f9950949ec672500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000291af233fcd4e402202682f7f64f045bc791b4650a75ed076914b7bf99612648e633cced5da519701120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000081c9868fcd4e40220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120e6676c4211ca4788f84d1291bda5274a8241f6605bde8592294257373e5e66bf000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000091ed0ad01fcd4e4022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000021201ca42fd2bb1cae5e65997c478738c256a83bb584ade465a67a59b9308fe6a9de0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000920c8fe01fcd4e402200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120a99e920ec8e96c88ca3a2cb150b44c97366caf27c83341ac473a20c08719fdc10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000922f69d03fcd4e40220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000212053b010c26f3607b68d73f91b92cfc0611137459ae8d3a27181b66b57be5e59400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000924a2e006fcd4e4022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000021208030337ba51b7a0e5b41959f4d6ba91f1fbf59587c530b1825ed0ff17b16dfa40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000926b6f30afcd4e402200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120f1a0d1147a5bcb8b70c43b3a0db822838c2c5cf1e1a702ca787d97e339d1a2c900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000009289ee30ffcd4e402200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120e59504ebf58e2dd8d45e2d4a9a1784110412145c8ab7ea33e1c5dc64b00d31f5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000092ab4f71cfcd4e402200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120c0669afcb102a1052fcdfd7042abeddc7657eed34c9698b3d2d0e236dba462ae00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002b2cda879601fed4e40220707c886c445cbd1c16cdc914db5a1fc748f37456ecef7172ecfeedfb44241c0a20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000a2ee8cfc101fed4e40220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000021208af8a52d523be0529a731d6fb9b10f76a7b3a49d1f3335e74299fc7b8b61d53400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002b30b8ab9502fed4e4022087c405a5f48df79a86afc9540499b6c075641c8ccdf7fcd23532d13d68c160d020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000007c636f6d6d69746d656e74732f706f7274732f7761736d2e756e696f6e316d383761357363786e6e6b38337766776170786c75667a6d35387165327636353938356578666637307a3935613279723836797137686c3038682f6368616e6e656c732f6368616e6e656c2d38322f73657175656e6365732f33333538393000000000000000000000000000000000000000000000000000000000000000000000002046716716a8f2475bbe33b855283bdd7ee27c882aa495412bb114cd895d7f05cc00000000000000000000000000000000000000000000000000000000000000060002e2d3e40200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000003e000000000000000000000000000000000000000000000000000000000000004c000000000000000000000000000000000000000000000000000000000000005a000000000000000000000000000000000000000000000000000000000000006800000000000000000000000000000000000000000000000000000000000000760000000000000000000000000000000000000000000000000000000000000082000000000000000000000000000000000000000000000000000000000000008e000000000000000000000000000000000000000000000000000000000000009a00000000000000000000000000000000000000000000000000000000000000a600000000000000000000000000000000000000000000000000000000000000b200000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000ce00000000000000000000000000000000000000000000000000000000000000da00000000000000000000000000000000000000000000000000000000000000e800000000000000000000000000000000000000000000000000000000000000f6000000000000000000000000000000000000000000000000000000000000010400000000000000000000000000000000000000000000000000000000000001120000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000012e000000000000000000000000000000000000000000000000000000000000013c000000000000000000000000000000000000000000000000000000000000014a0000000000000000000000000000000000000000000000000000000000000156000000000000000000000000000000000000000000000000000000000000016400000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000070204bcd4e402200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000212079a786317d3c1bcbba1b83ae2879ae7cd4d6a12b81dc7a485127f884a774934a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000070408bcd4e4022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120eb6ad27c7eadc545a7bcdd30057edd2f9dbc162b5f5b18fee16d0cc4c6bccecd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000070610bcd4e4022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120167d3d1b95e65e747805243e4e2528335addc2d010c564b098f30fb1eace0b5d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000070820ced4e4022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120437d3207d426aff783e628e9a168a80144fa47072af3cabd938a6c1ac785c716000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000070a34ced4e4022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120cd2f4a26247a12462cb7d0c32e9ac4f7eee1774055974be13332db04c842322600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000280c48ced4e40220291c7ea5a263ff860db6376cf28b90b341434314ddbe1a533ea0430d0c341f7d200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000280e72ced4e40220142b8b50a46d6b1fe46e0017c3fb6885b31e6c3d2bd60d8e64b3c694d18bffb0200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002910d001ced4e40220ca653fc2440cd426e2388ee2276504cbddc912c094af5e55e05c1a0c4ffbafa72000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002912e002ced4e402206f773d8a23bebf9e81fa22028c158c459e75d3549674b6742cbb3b95f7bc5fd22000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002914fe06fcd4e4022046c5706ad049ebf145d91d2daab621dc13f3295af175ab1bffe130a12aa8988f200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000816be0bfcd4e40220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120d0c0ee05aedecaa1cae2aa758f6f71c54188f55d160e1aa1184bfce0a8e2d5a10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000818ee13fcd4e402200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000021209b8f586e95fc8758f955833dca17d3717209fb2fb0bf586198f9950949ec672500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000291af233fcd4e402202682f7f64f045bc791b4650a75ed076914b7bf99612648e633cced5da519701120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000081c9868fcd4e40220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120e6676c4211ca4788f84d1291bda5274a8241f6605bde8592294257373e5e66bf000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000091ed0ad01fcd4e4022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000021201ca42fd2bb1cae5e65997c478738c256a83bb584ade465a67a59b9308fe6a9de0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000920c8fe01fcd4e402200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120a99e920ec8e96c88ca3a2cb150b44c97366caf27c83341ac473a20c08719fdc10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000922f69d03fcd4e40220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000212053b010c26f3607b68d73f91b92cfc0611137459ae8d3a27181b66b57be5e59400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000924a2e006fcd4e4022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000021208030337ba51b7a0e5b41959f4d6ba91f1fbf59587c530b1825ed0ff17b16dfa40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000926b6f30afcd4e402200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120f1a0d1147a5bcb8b70c43b3a0db822838c2c5cf1e1a702ca787d97e339d1a2c900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000009289ee30ffcd4e402200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120e59504ebf58e2dd8d45e2d4a9a1784110412145c8ab7ea33e1c5dc64b00d31f5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000092ab4f71cfcd4e402200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120c0669afcb102a1052fcdfd7042abeddc7657eed34c9698b3d2d0e236dba462ae00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002b2cda879601fed4e40220707c886c445cbd1c16cdc914db5a1fc748f37456ecef7172ecfeedfb44241c0a20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000a2ee8cfc101fed4e40220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000021208af8a52d523be0529a731d6fb9b10f76a7b3a49d1f3335e74299fc7b8b61d53400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002b30b8ab9502fed4e4022087c405a5f48df79a86afc9540499b6c075641c8ccdf7fcd23532d13d68c160d0200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000000369626300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020b7551e58a2b2a42979d94e488f48fc7866ce501e7966eb4d246d7c1b7377f3d100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002e000000000000000000000000000000000000000000000000000000000000003a0000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000202cd8b50700950546180ad979135a8708c2ea2098fff6ade31b7e40eb5dcf7c05000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000210110caf853b7db5835ea3637af866d62d49db0abe3a0cd35af226e3003122332c5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000210172804150dff46dae46458b6ee3579928f8009428e5a43744792dc9ed03f49bcf000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000021017f65eafca5c2ecbfef4f4fa0e9ac14eaeb32d918d548e1779813626d0710f2ce000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000205b6de24d13df1f0f1d0be2b3a60a552d0c7656e8f17a15b7eaf615e216c46c25");

        let proof = ethers::abi::ethabi::decode(
            &[
                ExistenceProofEthAbi::param_type(),
                ExistenceProofEthAbi::param_type(),
            ],
            &bz,
        )
        .unwrap();

        dbg!(proof);
    }
}
