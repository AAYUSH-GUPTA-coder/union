---
import "#/styles/fonts.css"
import "@shikijs/twoslash/style-rich.css"
import { highlightCode, type HighlightArgs } from "#/lib/highlight-code.ts"

interface Props extends HighlightArgs {}

const { code, lang = "plaintext" } = Astro.props

const highlightedCode = await highlightCode({ code: code.trim(), lang })
---

<div
  class="code-snippet font-mono overflow-auto max-h-[500px] h-full overflow-y-visible"
  set:html={highlightedCode}
/>

<style is:global>
  @media (prefers-color-scheme: light) {
    .shiki.dark-plus {
      display: none;
    }
  }
  @media (prefers-color-scheme: dark) {
    .shiki.light-plus {
      display: none;
    }
  }

  figure[data-rehype-pretty-code-figure] {
    max-width: 100%;
  }

  pre {
    white-space: pre;
    display: block;
  }

  figure[data-rehype-pretty-code-figure],
  pre {
    @apply rounded-lg overflow-visible;
    margin: 0;
    padding: 0;
    background-color: transparent;
    width: 100%;
    min-width: 100%;
  }

  code {
    width: 100%;
    overflow: visible;
  }

  .twoslash .twoslash-popup-scroll-container {
    max-height: 300px;
    padding: 4px 0;
    overflow-y: auto;
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .twoslash-popup-container {
    transform: translate(1.5em);
  }

  .twoslash {
    z-index: 999999999 !important;
    overflow: visible !important;
    display: inline-block;
    max-width: fit-content;
  }
  .twoslash,
  .twoslash-hover {
    z-index: 999999999 !important;
    border-bottom: 1px dotted transparent;
    transition-timing-function: ease;
    transition: border-color 0.3s;
    position: relative;
  }

  .twoslash-popup-docs,
  .twoslash-popup-code {
    @apply backdrop-blur-xl;
    font-family: var(--tw-font-family) !important;
    max-width: fit-content !important;
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    @apply break-words;
  }

  .twoslash > * {
    z-index: 999999999 !important;
  }

  .twoslash-popup-info-hover,
  .twoslash-popup-code,
  .twoslash-popup-arrow,
  .twoslash-popup-container {
    @apply backdrop-blur-xl;
    color: #f9f9f9 !important;
    overflow: visible !important;
    background-color: var(--tw-bg-opacity) !important;
    word-break: break-word;
  }

  .twoslash-popup-docs-tag {
    width: 100%;
    z-index: 999999999 !important;
  }

  .code-snippet > figure[data-rehype-pretty-code-figure] > pre {
    background-color: rgba(0, 0, 0, 0) !important;
  }

  figure pre code span {
    font-family: 'JetBrains Mono', monospace !important;
  }

  @media (max-width: 400px) {
    figure[data-rehype-pretty-code-figure] {
      max-width: 385px;
    }
  }
</style>
